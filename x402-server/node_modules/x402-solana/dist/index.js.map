{"version":3,"sources":["../src/utils/helpers.ts","../src/client/transaction-builder.ts","../src/client/payment-interceptor.ts","../src/client/index.ts","../src/server/facilitator-client.ts","../src/server/payment-handler.ts","../src/types/x402-protocol.ts","../src/types/solana-payment.ts"],"names":["Connection","PublicKey","ComputeBudgetProgram","TOKEN_2022_PROGRAM_ID","TOKEN_PROGRAM_ID","getMint","getAssociatedTokenAddress","createTransferCheckedInstruction","TransactionMessage","VersionedTransaction","z","ExactSvmPayloadSchema"],"mappings":"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","file":"index.js","sourcesContent":["import { VersionedTransaction } from \"@solana/web3.js\";\nimport { PaymentRequirements, SolanaNetwork, SPLTokenAmount } from \"../types\";\n\n/**\n * Helper utilities for x402 payment processing\n */\n\n/**\n * Create payment header from a signed transaction\n * Encodes transaction and payment details into base64 X-PAYMENT header\n */\nexport function createPaymentHeaderFromTransaction(\n  transaction: VersionedTransaction,\n  paymentRequirements: PaymentRequirements,\n  x402Version: number\n): string {\n  // Serialize the signed transaction\n  const serializedTransaction = Buffer.from(transaction.serialize()).toString(\"base64\");\n\n  // Create payment payload matching x402 spec\n  const paymentPayload = {\n    x402Version: x402Version,\n    scheme: paymentRequirements.scheme,\n    network: paymentRequirements.network,\n    payload: {\n      transaction: serializedTransaction,\n    },\n  };\n\n  // Encode payment payload as base64 for X-PAYMENT header\n  const paymentHeader = Buffer.from(JSON.stringify(paymentPayload)).toString(\"base64\");\n\n  return paymentHeader;\n}\n\n/**\n * Get default RPC URL for a given Solana network\n * @param network - Must be 'solana' or 'solana-devnet'\n * @returns Default RPC URL for the network\n */\nexport function getDefaultRpcUrl(network: SolanaNetwork): string {\n  if (network === \"solana\") {\n    return \"https://api.mainnet-beta.solana.com\";\n  } else if (network === \"solana-devnet\") {\n    return \"https://api.devnet.solana.com\";\n  }\n  // TypeScript ensures network is one of the two options, so this is unreachable\n  throw new Error(`Unexpected network: ${network}`);\n}\n\n/**\n * Get default SPL token asset for a given Solana network\n * Defaults to USDC, returns x402-compatible SPLTokenAmount['asset']\n */\nexport function getDefaultTokenAsset(network: SolanaNetwork): SPLTokenAmount['asset'] {\n  if (network === \"solana\") {\n    return {\n      address: \"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v\",\n      decimals: 6,\n    };\n  } else if (network === \"solana-devnet\") {\n    return {\n      address: \"4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU\",\n      decimals: 6,\n    };\n  }\n  // TypeScript ensures network is one of the two options, so this is unreachable\n  throw new Error(`Unexpected network: ${network}`);\n}\n\n/**\n * Convert human-readable amount to token's smallest unit (atomic units)\n * @param amount - Human-readable amount (e.g., 2.5 for 2.5 USDC)\n * @param decimals - Token decimals (e.g., 6 for USDC, 9 for SOL)\n */\nexport function toAtomicUnits(amount: number, decimals: number): bigint {\n  return BigInt(Math.floor(amount * Math.pow(10, decimals)));\n}\n\n/**\n * Convert token's atomic units to human-readable amount\n * @param atomicUnits - Token amount in smallest units\n * @param decimals - Token decimals (e.g., 6 for USDC, 9 for SOL)\n */\nexport function fromAtomicUnits(atomicUnits: bigint | number, decimals: number): number {\n  return Number(atomicUnits) / Math.pow(10, decimals);\n}\n\n// Legacy USDC-specific helpers (deprecated, use toAtomicUnits/fromAtomicUnits instead)\n/** @deprecated Use toAtomicUnits(amount, 6) instead */\nexport function usdToMicroUsdc(usdAmount: number): number {\n  return Math.floor(usdAmount * 1_000_000);\n}\n\n/** @deprecated Use fromAtomicUnits(microUsdc, 6) instead */\nexport function microUsdcToUsd(microUsdc: number): number {\n  return microUsdc / 1_000_000;\n}\n\n","import {\n  PublicKey,\n  Connection,\n  TransactionMessage,\n  VersionedTransaction,\n  ComputeBudgetProgram,\n  TransactionInstruction,\n} from \"@solana/web3.js\";\nimport {\n  getAssociatedTokenAddress,\n  createTransferCheckedInstruction,\n  getMint,\n  TOKEN_PROGRAM_ID,\n  TOKEN_2022_PROGRAM_ID,\n} from \"@solana/spl-token\";\nimport { PaymentRequirements, WalletAdapter } from \"../types\";\nimport { createPaymentHeaderFromTransaction } from \"../utils\";\n\n/**\n * Build and sign a Solana transaction for x402 payment\n */\nexport async function createSolanaPaymentHeader(\n  wallet: WalletAdapter,\n  x402Version: number,\n  paymentRequirements: PaymentRequirements,\n  rpcUrl: string\n): Promise<string> {\n  const connection = new Connection(rpcUrl, \"confirmed\");\n\n  // Extract fee payer from payment requirements\n  const feePayer = (paymentRequirements as { extra?: { feePayer?: string } })?.extra?.feePayer;\n  if (typeof feePayer !== \"string\" || !feePayer) {\n    throw new Error(\"Missing facilitator feePayer in payment requirements (extra.feePayer).\");\n  }\n  const feePayerPubkey = new PublicKey(feePayer);\n\n  // Support both Anza wallet-adapter (publicKey) and custom implementations (address)\n  const walletAddress = wallet?.publicKey?.toString() || wallet?.address;\n  if (!walletAddress) {\n    throw new Error(\"Missing connected Solana wallet address or publicKey\");\n  }\n  const userPubkey = new PublicKey(walletAddress);\n\n  if (!paymentRequirements?.payTo) {\n    throw new Error(\"Missing payTo in payment requirements\");\n  }\n  const destination = new PublicKey(paymentRequirements.payTo);\n\n  const instructions: TransactionInstruction[] = [];\n\n  // The facilitator REQUIRES ComputeBudget instructions in positions 0 and 1\n  instructions.push(\n    ComputeBudgetProgram.setComputeUnitLimit({\n      units: 7_000, // Sufficient for SPL token transfer\n    })\n  );\n\n  instructions.push(\n    ComputeBudgetProgram.setComputeUnitPrice({\n      microLamports: 1, // Minimal price\n    })\n  );\n\n  // SPL token or Token-2022\n  if (!paymentRequirements.asset) {\n    throw new Error(\"Missing token mint for SPL transfer\");\n  }\n  const mintPubkey = new PublicKey(paymentRequirements.asset as string);\n\n  // Determine program (token vs token-2022) by reading mint owner\n  const mintInfo = await connection.getAccountInfo(mintPubkey, \"confirmed\");\n  const programId =\n    mintInfo?.owner?.toBase58() === TOKEN_2022_PROGRAM_ID.toBase58()\n      ? TOKEN_2022_PROGRAM_ID\n      : TOKEN_PROGRAM_ID;\n\n  // Fetch mint to get decimals\n  const mint = await getMint(connection, mintPubkey, undefined, programId);\n\n  // Derive source and destination ATAs\n  const sourceAta = await getAssociatedTokenAddress(\n    mintPubkey,\n    userPubkey,\n    false,\n    programId\n  );\n  const destinationAta = await getAssociatedTokenAddress(\n    mintPubkey,\n    destination,\n    false,\n    programId\n  );\n\n  // Check if source ATA exists (user must already have token account)\n  const sourceAtaInfo = await connection.getAccountInfo(sourceAta, \"confirmed\");\n  if (!sourceAtaInfo) {\n    throw new Error(\n      `User does not have an Associated Token Account for ${paymentRequirements.asset}. Please create one first or ensure you have the required token.`\n    );\n  }\n\n  // Check if destination ATA exists (receiver must already have token account)\n  const destAtaInfo = await connection.getAccountInfo(destinationAta, \"confirmed\");\n  if (!destAtaInfo) {\n    throw new Error(\n      `Destination does not have an Associated Token Account for ${paymentRequirements.asset}. The receiver must create their token account before receiving payments.`\n    );\n  }\n\n  // TransferChecked instruction\n  const amount = BigInt(paymentRequirements.maxAmountRequired);\n\n  instructions.push(\n    createTransferCheckedInstruction(\n      sourceAta,\n      mintPubkey,\n      destinationAta,\n      userPubkey,\n      amount,\n      mint.decimals,\n      [],\n      programId\n    )\n  );\n\n  // Get recent blockhash\n  const { blockhash } = await connection.getLatestBlockhash(\"confirmed\");\n\n  const message = new TransactionMessage({\n    payerKey: feePayerPubkey,\n    recentBlockhash: blockhash,\n    instructions,\n  }).compileToV0Message();\n\n  // Create transaction\n  const transaction = new VersionedTransaction(message);\n\n  // Sign with user's wallet\n  if (typeof wallet?.signTransaction !== \"function\") {\n    throw new Error(\"Connected wallet does not support signTransaction\");\n  }\n\n  const userSignedTx = await wallet.signTransaction(transaction);\n\n  return createPaymentHeaderFromTransaction(\n    userSignedTx,\n    paymentRequirements,\n    x402Version\n  );\n}\n\n","import { PaymentRequirements, x402Response, WalletAdapter } from \"../types\";\nimport { createSolanaPaymentHeader } from \"./transaction-builder\";\n\n/**\n * Create a custom fetch function that automatically handles x402 payments\n */\nexport function createPaymentFetch(\n  fetchFn: typeof fetch,\n  wallet: WalletAdapter,\n  rpcUrl: string,\n  maxValue: bigint = BigInt(0)\n) {\n  return async (input: RequestInfo, init?: RequestInit): Promise<Response> => {\n    // Make initial request\n    const response = await fetchFn(input, init);\n\n    // If not 402, return as-is\n    if (response.status !== 402) {\n      return response;\n    }\n\n    // Parse payment requirements from 402 response\n    const rawResponse = await response.json() as x402Response;\n\n    const x402Version: number = rawResponse.x402Version;\n    const parsedPaymentRequirements: PaymentRequirements[] = rawResponse.accepts || [];\n\n    // Select first suitable payment requirement for Solana\n    const selectedRequirements = parsedPaymentRequirements.find(\n      (req: PaymentRequirements) =>\n        req.scheme === \"exact\" &&\n        (req.network === \"solana-devnet\" || req.network === \"solana\")\n    );\n\n    if (!selectedRequirements) {\n      console.error(\n        \"âŒ No suitable Solana payment requirements found. Available networks:\",\n        parsedPaymentRequirements.map((req) => req.network)\n      );\n      throw new Error(\"No suitable Solana payment requirements found\");\n    }\n\n    // Check amount against max value if specified\n    if (maxValue > BigInt(0) && BigInt(selectedRequirements.maxAmountRequired) > maxValue) {\n      throw new Error(\"Payment amount exceeds maximum allowed\");\n    }\n\n    // Create payment header using Solana transaction builder\n    const paymentHeader = await createSolanaPaymentHeader(\n      wallet,\n      x402Version,\n      selectedRequirements,\n      rpcUrl\n    );\n\n    // Retry with payment header\n    const newInit = {\n      ...init,\n      headers: {\n        ...(init?.headers || {}),\n        \"X-PAYMENT\": paymentHeader,\n        \"Access-Control-Expose-Headers\": \"X-PAYMENT-RESPONSE\",\n      },\n    };\n\n    return await fetchFn(input, newInit);\n  };\n}\n\n","import { X402ClientConfig } from \"../types\";\nimport { getDefaultRpcUrl } from \"../utils\";\nimport { createPaymentFetch } from \"./payment-interceptor\";\n\n/**\n * x402 Solana Client\n * Handles automatic payment for x402-protected endpoints\n */\n\nexport class X402Client {\n  private paymentFetch: ReturnType<typeof createPaymentFetch>;\n\n  constructor(config: X402ClientConfig) {\n    const rpcUrl = config.rpcUrl || getDefaultRpcUrl(config.network);\n\n    // Use custom fetch if provided, otherwise use native fetch\n    // globalThis.fetch works in both browser and Node.js (18+)\n    const fetchFn = config.customFetch || globalThis.fetch.bind(globalThis);\n\n    this.paymentFetch = createPaymentFetch(\n      fetchFn,\n      config.wallet,\n      rpcUrl,\n      config.maxPaymentAmount || BigInt(0)\n    );\n  }\n\n  /**\n   * Make a fetch request with automatic x402 payment handling.\n   * If a customFetch was provided in the config, it will be used for all requests.\n   */\n  async fetch(input: RequestInfo, init?: RequestInit): Promise<Response> {\n    return this.paymentFetch(input, init);\n  }\n}\n\n/**\n * Create an x402 client instance\n */\nexport function createX402Client(config: X402ClientConfig): X402Client {\n  return new X402Client(config);\n}\n\n// Re-export types for convenience\nexport type { X402ClientConfig, WalletAdapter } from \"../types\";\n\n","import {\n  PaymentRequirements,\n  VerifyResponse,\n  SettleResponse,\n  SupportedPaymentKindsResponse,\n  SupportedPaymentKind,\n} from \"../types\";\n\ntype SupportedPaymentKindType = SupportedPaymentKind;\n\n/**\n * Client for communicating with x402 facilitator service\n */\nexport class FacilitatorClient {\n  constructor(private facilitatorUrl: string) { }\n\n  /**\n   * Get fee payer address from facilitator's /supported endpoint\n   */\n  async getFeePayer(network: string): Promise<string> {\n    const response = await fetch(`${this.facilitatorUrl}/supported`);\n    if (!response.ok) {\n      throw new Error(`Facilitator /supported returned ${response.status}`);\n    }\n\n    const supportedData: SupportedPaymentKindsResponse = await response.json();\n\n    // Look for network support and extract fee payer\n    const networkSupport = supportedData.kinds?.find(\n      (kind: SupportedPaymentKindType) => kind.network === network && kind.scheme === \"exact\"\n    );\n\n    if (!networkSupport?.extra?.feePayer) {\n      throw new Error(\n        `Facilitator does not support network \"${network}\" with scheme \"exact\" or feePayer not provided`\n      );\n    }\n\n    return networkSupport.extra.feePayer;\n  }\n\n  /**\n   * Verify payment with facilitator\n   * @returns VerifyResponse with isValid and optional invalidReason from facilitator\n   */\n  async verifyPayment(\n    paymentHeader: string,\n    paymentRequirements: PaymentRequirements\n  ): Promise<VerifyResponse> {\n    try {\n      // Decode the base64 payment payload\n      const paymentPayload = JSON.parse(\n        Buffer.from(paymentHeader, \"base64\").toString(\"utf8\")\n      );\n\n      const verifyPayload = {\n        paymentPayload,\n        paymentRequirements,\n      };\n\n      const response = await fetch(`${this.facilitatorUrl}/verify`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(verifyPayload),\n      });\n\n      if (!response.ok) {\n        const errorBody = await response.text();\n        console.error(`Facilitator /verify returned ${response.status}:`, errorBody);\n        return {\n          isValid: false,\n          invalidReason: \"unexpected_verify_error\",\n        };\n      }\n\n      // Facilitator returns VerifyResponse with status 200 even when validation fails\n      const facilitatorResponse: VerifyResponse = await response.json();\n      return facilitatorResponse;\n    } catch (error) {\n      console.error(\"Payment verification failed:\", error);\n      return {\n        isValid: false,\n        invalidReason: \"unexpected_verify_error\",\n      };\n    }\n  }\n\n  /**\n   * Settle payment with facilitator\n   * @returns SettleResponse with success status and optional errorReason from facilitator\n   */\n  async settlePayment(\n    paymentHeader: string,\n    paymentRequirements: PaymentRequirements\n  ): Promise<SettleResponse> {\n    try {\n      // Decode the base64 payment payload\n      const paymentPayload = JSON.parse(\n        Buffer.from(paymentHeader, \"base64\").toString(\"utf8\")\n      );\n\n      const settlePayload = {\n        paymentPayload,\n        paymentRequirements,\n      };\n\n      const response = await fetch(`${this.facilitatorUrl}/settle`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(settlePayload),\n      });\n\n      if (!response.ok) {\n        const errorBody = await response.text();\n        console.error(`Facilitator /settle returned ${response.status}:`, errorBody);\n        return {\n          success: false,\n          errorReason: \"unexpected_settle_error\",\n          transaction: \"\",\n          network: paymentRequirements.network,\n        };\n      }\n\n      // Facilitator returns SettleResponse with status 200 even when settlement fails\n      const facilitatorResponse: SettleResponse = await response.json();\n      return facilitatorResponse;\n    } catch (error) {\n      console.error(\"Payment settlement failed:\", error);\n      return {\n        success: false,\n        errorReason: \"unexpected_settle_error\",\n        transaction: \"\",\n        network: paymentRequirements.network,\n      };\n    }\n  }\n}\n\n","import { X402ServerConfig, PaymentRequirements, RouteConfig, SPLTokenAmount, VerifyResponse, SettleResponse } from \"../types\";\nimport { getDefaultRpcUrl, getDefaultTokenAsset } from \"../utils\";\nimport { FacilitatorClient } from \"./facilitator-client\";\n\n/**\n * x402 Payment Handler for server-side payment processing\n * Framework agnostic - works with any Node.js HTTP framework\n */\ninterface InternalConfig {\n  network: X402ServerConfig['network'];\n  treasuryAddress: string;\n  facilitatorUrl: string;\n  rpcUrl: string;\n  defaultToken: SPLTokenAmount['asset'];\n  middlewareConfig?: X402ServerConfig['middlewareConfig'];\n}\n\nexport class X402PaymentHandler {\n  private facilitatorClient: FacilitatorClient;\n  private config: InternalConfig;\n\n  constructor(config: X402ServerConfig) {\n    const defaultToken = getDefaultTokenAsset(config.network);\n\n    this.config = {\n      network: config.network,\n      treasuryAddress: config.treasuryAddress,\n      facilitatorUrl: config.facilitatorUrl,\n      rpcUrl: config.rpcUrl || getDefaultRpcUrl(config.network),\n      defaultToken: config.defaultToken || defaultToken,\n      middlewareConfig: config.middlewareConfig,\n    };\n\n    this.facilitatorClient = new FacilitatorClient(config.facilitatorUrl);\n  }\n\n  /**\n   * Extract payment header from request headers\n   * Pass in headers object from any framework (Next.js, Express, etc.)\n   */\n  extractPayment(headers: Record<string, string | string[] | undefined> | Headers): string | null {\n    // Handle Headers object (Next.js, Fetch API)\n    if (headers instanceof Headers) {\n      return headers.get(\"X-PAYMENT\") || headers.get(\"x-payment\");\n    }\n\n    // Handle plain object (Express, Fastify, etc.)\n    const xPayment = headers[\"X-PAYMENT\"] || headers[\"x-payment\"];\n    return Array.isArray(xPayment) ? xPayment[0] || null : xPayment || null;\n  }\n\n  /**\n   * Create payment requirements object from x402 RouteConfig\n   * @param routeConfig - x402 standard RouteConfig (price, network, config)\n   * @param resource - Optional resource URL override (uses config.resource if not provided)\n   */\n  async createPaymentRequirements(\n    routeConfig: RouteConfig,\n    resource?: string\n  ): Promise<PaymentRequirements> {\n    const feePayer = await this.facilitatorClient.getFeePayer(this.config.network);\n\n    // Extract SPLTokenAmount from price (supports Price union type)\n    const price = routeConfig.price as SPLTokenAmount;\n\n    // Merge config: routeConfig.config overrides server middlewareConfig defaults\n    const config = { ...this.config.middlewareConfig, ...routeConfig.config };\n\n    // Resource: use override if provided, otherwise use config.resource\n    const finalResource = resource || config.resource;\n    if (!finalResource) {\n      throw new Error(\"resource is required: provide either as parameter or in RouteConfig.config.resource\");\n    }\n\n    // Always include outputSchema field (required for facilitator discovery)\n    const paymentRequirements: PaymentRequirements = {\n      scheme: \"exact\",\n      network: routeConfig.network as typeof this.config.network,\n      maxAmountRequired: price.amount,\n      resource: finalResource,\n      description: config.description || \"Payment required\",\n      mimeType: config.mimeType || \"application/json\",\n      payTo: this.config.treasuryAddress,\n      maxTimeoutSeconds: config.maxTimeoutSeconds || 300,\n      asset: price.asset.address,\n      outputSchema: config.outputSchema || {},\n      extra: {\n        feePayer,\n      },\n    };\n\n    return paymentRequirements;\n  }\n\n  /**\n   * Create a 402 Payment Required response body\n   * Use this with your framework's response method\n   * @param requirements - Payment requirements (from createPaymentRequirements)\n   */\n  create402Response(requirements: PaymentRequirements): {\n    status: 402;\n    body: {\n      x402Version: number;\n      accepts: PaymentRequirements[];\n      error?: string;\n    };\n  } {\n    return {\n      status: 402,\n      body: {\n        x402Version: 1,\n        accepts: [requirements],\n        error: \"Payment required\",\n      },\n    };\n  }\n\n  /**\n   * Verify payment with facilitator\n   * @returns VerifyResponse with isValid and optional invalidReason\n   */\n  async verifyPayment(\n    paymentHeader: string,\n    paymentRequirements: PaymentRequirements\n  ): Promise<VerifyResponse> {\n    return this.facilitatorClient.verifyPayment(paymentHeader, paymentRequirements);\n  }\n\n  /**\n   * Settle payment with facilitator\n   * @returns SettleResponse with success status and optional errorReason\n   */\n  async settlePayment(\n    paymentHeader: string,\n    paymentRequirements: PaymentRequirements\n  ): Promise<SettleResponse> {\n    return this.facilitatorClient.settlePayment(paymentHeader, paymentRequirements);\n  }\n}\n\n","import { z } from \"zod\";\nimport { ExactSvmPayloadSchema } from \"x402/types\";\n\n/**\n * Solana-specific x402 Protocol Types\n * These are Solana-only variants of x402 protocol types\n */\n\n// Solana-only network enum\nexport const SolanaNetworkSchema = z.enum([\n  \"solana-devnet\",\n  \"solana\"\n]);\n\nexport type SolanaNetwork = z.infer<typeof SolanaNetworkSchema>;\n\n// Solana-specific payment payload schema\nexport const SolanaPaymentPayloadSchema = z.object({\n  x402Version: z.literal(1),\n  scheme: z.literal(\"exact\"),\n  network: SolanaNetworkSchema,\n  payload: ExactSvmPayloadSchema, // Official SVM payload from x402\n});\n\nexport type SolanaPaymentPayload = z.infer<typeof SolanaPaymentPayloadSchema>;\n\n","import { VersionedTransaction } from \"@solana/web3.js\";\nimport { SolanaNetwork } from \"./x402-protocol\";\nimport type { PaymentMiddlewareConfig, SPLTokenAmount, RouteConfig } from \"x402/types\";\n\n/**\n * Solana-specific payment types\n */\n\n// Re-export x402 types\nexport type { PaymentMiddlewareConfig, SPLTokenAmount, RouteConfig };\n\n// Wallet adapter interface - framework agnostic\n// Compatible with both Anza wallet-adapter and custom implementations\nexport interface WalletAdapter {\n  publicKey?: { toString(): string }; // Anza wallet-adapter standard\n  address?: string; // Alternative property\n  signTransaction: (tx: VersionedTransaction) => Promise<VersionedTransaction>;\n}\n\n// Client configuration\nexport interface X402ClientConfig {\n  wallet: WalletAdapter;\n  network: SolanaNetwork;\n  rpcUrl?: string;\n  maxPaymentAmount?: bigint;\n  /**\n   * Optional custom fetch function for making HTTP requests.\n   * Useful for routing requests through a proxy server to avoid CORS issues\n   * or adding custom request/response handling.\n   *\n   * @default globalThis.fetch\n   *\n   * @example\n   * ```typescript\n   * // Using a proxy to bypass CORS\n   * const proxyFetch = async (url, init) => {\n   *   const proxyUrl = 'https://your-proxy.com/proxy';\n   *   return fetch(proxyUrl, {\n   *     method: 'POST',\n   *     headers: { 'Content-Type': 'application/json' },\n   *     body: JSON.stringify({ url, method: init?.method, headers: init?.headers, body: init?.body })\n   *   }).then(async (res) => {\n   *     const proxyData = await res.json();\n   *     return new Response(\n   *       typeof proxyData.data === 'string' ? proxyData.data : JSON.stringify(proxyData.data),\n   *       { status: proxyData.status, statusText: proxyData.statusText, headers: new Headers(proxyData.headers) }\n   *     );\n   *   });\n   * };\n   *\n   * const client = createX402Client({\n   *   wallet,\n   *   network: 'solana-devnet',\n   *   customFetch: proxyFetch\n   * });\n   * ```\n   */\n  customFetch?: typeof fetch;\n}\n\n// Server configuration - aligns with x402 RouteConfig pattern\nexport interface X402ServerConfig {\n  network: SolanaNetwork;\n  treasuryAddress: string; // Where payments are sent (payTo)\n  facilitatorUrl: string;\n  rpcUrl?: string;\n  defaultToken?: SPLTokenAmount['asset']; // Default token to accept (defaults to USDC)\n  middlewareConfig?: PaymentMiddlewareConfig; // Default middleware config\n}\n\n// Helper function to check if a network is Solana-based\nexport function isSolanaNetwork(network: string): network is \"solana\" | \"solana-devnet\" {\n  return network === \"solana\" || network === \"solana-devnet\";\n}\n\n"]}